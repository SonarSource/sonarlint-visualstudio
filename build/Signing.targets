<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="14.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!-- Targets to handle signing assemblies using Azure Trusted Signing via Sign CLI.

       Usage:
       The following items should be set by the caller:
       * @(AssembliesToSign)    : the list of assemblies to sign

       Prerequisites:
       * Sign CLI must be installed: dotnet tool install ‑‑global sign ‑‑prerelease
       * Azure CLI must be authenticated via azure/login (OIDC)
  -->
  <PropertyGroup>
    <TrustedSigningAccount>sonarsource-codesigning</TrustedSigningAccount>
    <TrustedSigningCertificateProfile>sonarsource-release</TrustedSigningCertificateProfile>
    <TrustedSigningEndpoint>https://weu.codesigning.azure.net</TrustedSigningEndpoint>
  </PropertyGroup>

  <Target Name="SignAssemblies">
    <Message Importance="high" Text="Assembly to sign: %(AssembliesToSign.FullPath)" />
    <Error Condition=" @(AssembliesToSign) == '' " Text="The list of assemblies to sign is empty." />

    <Exec Command="sign code trusted-signing &quot;%(AssembliesToSign.FullPath)&quot; --trusted-signing-account $(TrustedSigningAccount) --trusted-signing-certificate-profile $(TrustedSigningCertificateProfile) --trusted-signing-endpoint $(TrustedSigningEndpoint)" />
  </Target>

</Project>
