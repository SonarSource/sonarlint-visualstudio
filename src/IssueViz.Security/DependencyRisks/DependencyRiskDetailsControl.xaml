<UserControl x:Class="SonarLint.VisualStudio.IssueVisualization.Security.DependencyRisks.DependencyRiskDetailsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:res="clr-namespace:SonarLint.VisualStudio.IssueVisualization.Security"
             xmlns:dependencyRisks="clr-namespace:SonarLint.VisualStudio.IssueVisualization.Security.DependencyRisks"
             xmlns:vsshell="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
             xmlns:vsTheming="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0"
             FocusManager.FocusedElement="{Binding ElementName=HotspotsDataGrid}"
             DataContext="{Binding ViewModel, RelativeSource={RelativeSource Mode=Self}}">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary
                    Source="../DependencyRisks/DependencyRiskImpactSeverity.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <dependencyRisks:DependencyRiskSeverityToResourceConverter
                x:Key="DependencyRiskSeverityToResourceConverter" />

            <Style TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.WindowTextKey}}" />
                <Setter Property="FontSize" Value="{DynamicResource {x:Static vsshell:VsFonts.EnvironmentFontSizeKey}}" />
                <Setter Property="FontFamily"
                        Value="{DynamicResource {x:Static vsshell:VsFonts.EnvironmentFontFamilyKey}}" />
                <Setter Property="VerticalAlignment" Value="Center" />
            </Style>

            <Style x:Key="HeaderTextStyle" TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                <Setter Property="FontSize"
                        Value="{DynamicResource {x:Static vsshell:VsFonts.Environment155PercentFontSizeKey}}" />
                <Setter Property="FontWeight" Value="Bold" />
            </Style>

            <Style x:Key="SubHeaderTextStyle" TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                <Setter Property="FontSize"
                        Value="{DynamicResource {x:Static vsshell:VsFonts.Environment133PercentFontSizeKey}}" />
                <Setter Property="FontWeight" Value="SemiBold" />
            </Style>

            <Style x:Key="Header3TextStyle" TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                <Setter Property="FontSize"
                        Value="{DynamicResource {x:Static vsshell:VsFonts.Environment111PercentFontSizeKey}}" />
                <Setter Property="FontWeight" Value="SemiBold" />
            </Style>

            <Style x:Key="BodyTextStyle" TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                <Setter Property="FontSize" Value="{DynamicResource {x:Static vsshell:VsFonts.EnvironmentFontSizeKey}}" />
                <Setter Property="TextWrapping" Value="Wrap" />

            </Style>

            <Style x:Key="SmallTextStyle" TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                <Setter Property="FontSize"
                        Value="{DynamicResource {x:Static vsshell:VsFonts.Environment90PercentFontSizeKey}}" />
            </Style>

            <Style x:Key="TabGridStyle" TargetType="Grid">
                <Setter Property="Margin" Value="18,10,0,0" />
            </Style>

            <Style x:Key="CvssBorderStyle" TargetType="Border">
                <Setter Property="BorderBrush" Value="#E0E0E0" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="10,3" />
                <Setter Property="HorizontalAlignment" Value="Left" />
            </Style>

            <Style TargetType="TabControl">
                <Setter Property="Margin" Value="0, 0, 0, 0" />
                <Setter Property="Padding" Value="0, 0, 0, 0" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabControl">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <StackPanel>
                                    <TabPanel x:Name="HeaderPanel"
                                              Panel.ZIndex="1"
                                              KeyboardNavigation.TabIndex="1"
                                              Margin="2,2,2,0"
                                              IsItemsHost="true" />
                                </StackPanel>
                                <ContentPresenter x:Name="PART_SelectedContentHost"
                                                  SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                                  Margin="-10,0,0,0"
                                                  ContentSource="SelectedContent"
                                                  Grid.Row="1"
                                                  Focusable="True"
                                                  KeyboardNavigation.TabIndex="3"
                                                  AutomationProperties.Name="{Binding ElementName=Root, Path=StackTrace}" />
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style TargetType="TabItem">
                <Setter Property="FontFamily" Value="{DynamicResource {x:Static vsshell:VsFonts.CaptionFontFamilyKey}}" />
                <Setter Property="Background"
                        Value="{DynamicResource {x:Static vsshell:VsBrushes.BrandedUIBackgroundKey}}" />
                <Setter Property="FontSize"
                        Value="{DynamicResource {x:Static vsshell:VsFonts.Environment122PercentFontSizeKey}}" />
                <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.BrandedUITextKey}}" />
                <Setter Property="Margin" Value="-2,-2,0,0" />
                <Setter Property="FocusVisualStyle" Value="{DynamicResource ControlsFocusVisualStyle}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type TabItem}">
                            <Grid x:Name="templateRoot" SnapsToDevicePixels="true">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                </Grid.RowDefinitions>
                                <Border x:Name="mainBorder" Background="{TemplateBinding Background}"
                                        BorderThickness="0" Margin="0" />
                                <ContentPresenter Grid.Row="0" x:Name="contentPresenter" ContentSource="Header"
                                                  Focusable="False"
                                                  HorizontalAlignment="{Binding HorizontalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                                  Margin="{TemplateBinding Padding}" RecognizesAccessKey="True"
                                                  SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                                  VerticalAlignment="{Binding VerticalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" />
                                <!-- the line under the text to indicate that this label is selected -->
                                <Rectangle
                                    x:Name="_underline"
                                    Grid.Row="1"
                                    Height="3"
                                    Visibility="Collapsed"
                                    Width="{Binding ActualWidth, ElementName=contentPresenter}"
                                    HorizontalAlignment="Center"
                                    Fill="{DynamicResource {x:Static vsTheming:CommonDocumentColors.InnerTabInactiveHoverTextBrushKey}}" />
                            </Grid>
                            <ControlTemplate.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding IsSelected, RelativeSource={RelativeSource Self}}"
                                                   Value="true" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" TargetName="_underline" Value="Visible" />
                                    <Setter Property="Foreground"
                                            Value="{DynamicResource {x:Static vsTheming:CommonDocumentColors.InnerTabSelectedTextBrushKey }}" />
                                </MultiDataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding IsKeyboardFocused, RelativeSource={RelativeSource Self}}"
                                            Value="true" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Foreground"
                                            Value="{DynamicResource {x:Static vsTheming:CommonDocumentColors.InnerTabTextFocusedBrushKey}}" />
                                </MultiDataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition
                                            Binding="{Binding IsMouseOver, RelativeSource={RelativeSource Self}}"
                                            Value="true" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Foreground"
                                            Value="{DynamicResource {x:Static vsTheming:CommonDocumentColors.InnerTabTextHoverBrushKey }}" />
                                </MultiDataTrigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

        </ResourceDictionary>


    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="5,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Style="{StaticResource HeaderTextStyle}">
                    <Hyperlink NavigateUri="https://www.sonarsource.com" RequestNavigate="OnNavigateToDependencyRisk"
                               FontWeight="Bold">
                        <Run Text="{Binding Path=VulnerabilityId, Mode=OneWay}" />
                    </Hyperlink>

                    <Run Text="-" />
                    <Run Text="{Binding Path=VulnerabilityDescription, Mode=OneWay}" />
                </TextBlock>
            </Grid>

            <Grid Grid.Row="1" Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{x:Static res:Resources.DependencyRiskDetails_SeverityImpact}"
                           Style="{StaticResource SmallTextStyle}" />

                <Border Grid.Column="1" Margin="5,0" VerticalAlignment="Center">
                    <Border.Style>
                        <MultiBinding
                            Converter="{StaticResource DependencyRiskSeverityToResourceConverter}"
                            ConverterParameter="SeverityBubble">
                            <Binding Path="Severity" Mode="OneWay"/>
                            <Binding RelativeSource="{RelativeSource Self}" />
                            <Binding Path="ResourceFinder"
                                     RelativeSource="{RelativeSource FindAncestor, AncestorType=UserControl}" />
                        </MultiBinding>
                    </Border.Style>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{Binding Severity, Mode=OneWay}"
                                   Margin="5,0" />
                        <Image Grid.Column="1">
                            <Image.Source>
                                <MultiBinding
                                    Converter="{StaticResource DependencyRiskSeverityToResourceConverter}"
                                    ConverterParameter="SeverityDrawingImage">
                                    <Binding Path="Severity" Mode="OneWay"/>
                                    <Binding RelativeSource="{RelativeSource Self}" />
                                    <Binding Path="ResourceFinder"
                                             RelativeSource="{RelativeSource FindAncestor, AncestorType=UserControl}" />
                                </MultiBinding>
                            </Image.Source>
                        </Image>
                    </Grid>

                </Border>

            </Grid>

            <Border Grid.Row="2" Style="{StaticResource CvssBorderStyle}" Margin="5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="{x:Static res:Resources.DependencyRiskDetails_CvssScore}"
                               Style="{StaticResource Header3TextStyle}" />
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="2,0">
                        <TextBlock Text="{Binding ImpactScore, Mode=OneWay}" Style="{StaticResource BodyTextStyle}" />
                        <TextBlock Text="{Binding  ImpactDescription, Mode=OneWay}" Style="{StaticResource BodyTextStyle}"
                                   Margin="2" />
                    </StackPanel>
                </Grid>
            </Border>

            <TabControl Grid.Row="3" Margin="0,15">
                <TabItem Header="{x:Static res:Resources.DependencyRiskDetails_WhatRisk}">
                    <Grid Style="{StaticResource TabGridStyle}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Margin="0,0,10,0">
                            <TextBlock Text="Description" Style="{StaticResource SubHeaderTextStyle}" />
                            <TextBlock Style="{StaticResource BodyTextStyle}" Text="{Binding Description, Mode=OneWay}"
                                       Margin="0,10" />
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="{x:Static res:Resources.DependencyRiskDetails_HowToFix}">
                    <Grid Style="{StaticResource TabGridStyle}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Margin="0,0,10,0">
                            <TextBlock Text="{x:Static res:Resources.DependencyRiskDetails_UpdateDependencyHeader}"
                                       Style="{StaticResource SubHeaderTextStyle}" />
                            <TextBlock Style="{StaticResource BodyTextStyle}"
                                       Text="{x:Static res:Resources.DependencyRiskDetails_UpdateDependencyDescription}"
                                       Margin="0,10" />
                        </StackPanel>

                        <StackPanel Grid.Row="1" Margin="0,0,10,0">
                            <TextBlock Text="{x:Static res:Resources.DependencyRiskDetails_FindAlternativeHeader}"
                                       Style="{StaticResource SubHeaderTextStyle}" />
                            <TextBlock Style="{StaticResource BodyTextStyle}"
                                       Text="{x:Static res:Resources.DependencyRiskDetails_FindAlternativeDescription}"
                                       Margin="0,10" />
                        </StackPanel>
                    </Grid>
                </TabItem>
            </TabControl>

        </Grid>
    </ScrollViewer>
</UserControl>